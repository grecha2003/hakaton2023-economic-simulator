import * as dotenv from 'dotenv'
dotenv.config()
import { Telegraf } from 'telegraf';
import { message } from 'telegraf/filters';
import { Markup } from 'telegraf';
import { session } from 'telegraf';
import { MySQL } from "@telegraf/session/mysql";
import * as db from './database.js';


const bot = new Telegraf(process.env.BOT_TOKEN);

const pool = db.pool
const store = MySQL({ 
  database: 'game',
  host: 'localhost',
  user: 'user',
  password: 'ilya333',
  table: 'sessions'
})

// bot.use(session({ store }));
bot.use(session( { store: store, defaultSession: () => ({}) }));


// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ /start
bot.start(async (ctx) => {
  const userid = ctx.from.id;
  let user = await db.getUser(userid)
  if (user == undefined) {
    await ctx.reply('Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ! Ð•ÑÐ»Ð¸ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð·Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ, Ð½Ð°Ð¶Ð¼Ð¸Ñ‚Ðµ ÐºÐ½Ð¾Ð¿ÐºÑƒ!', Markup
      .keyboard([
        ['Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ']
      ]).resize())
  } else {
    ctx.session.state = ''
    await ctx.reply('Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ! Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:', Markup
      .keyboard([
        ['ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ', 'ÐœÐ¾Ð¸ Ð±Ð¸Ð·Ð½ÐµÑÑ‹'],
        ['Ð§Ð°Ñ‚ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²', 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸'],
        ['ÐŸÐ»Ð¾Ñ‰Ð°Ð´ÐºÐ° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸', 'ÐšÐ°Ñ€Ñ‚Ð° Ð±Ð¸Ð·Ð½ÐµÑÐ¾Ð²'],
        ['ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð¿Ð¾ Ð¸Ð³Ñ€Ðµ']
      ])
      .resize()
    );
  }
});

bot.hears('Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ', async (ctx) => {
  console.log(ctx.session)
  ctx.session.state = 'wait_for_name'
  await ctx.reply('Ð¡ÐºÐ°Ð¶Ð¸Ñ‚Ðµ, ÐºÐ°Ðº Ð²Ð°Ñ Ð½Ð°Ð·Ñ‹Ð²Ð°Ñ‚ÑŒ?')
})

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ"
bot.hears('ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ', async (ctx) => {
  // ctx.reply('Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ ÑÐ²Ð¾ÐµÐ¹ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»Ð¸ Ð·Ð´ÐµÑÑŒ.');
  let result = await db.tickGame(ctx.from.id)
  if (result.nobusiness) {
    await ctx.reply('Ð’Ñ‹ Ð½Ðµ Ð·Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¸ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð½Ð¸ Ñ ÐºÐ°ÐºÐ¸Ñ… Ð±Ð¸Ð·Ð½ÐµÑÐ¾Ð²!')
  } else if (result.didClaim) {
    await ctx.reply(`Ð¡ÐµÐ³Ð¾Ð´Ð½Ñ Ð²Ñ‹ Ð·Ð°Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»Ð¸ ${result.profitSum}!`)
  } else {
    await ctx.reply('Ð’Ñ‹ ÑƒÐ¶Ðµ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð»Ð¸ ÑÐµÐ³Ð¾Ð´Ð½Ñ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ, Ð·Ð°Ð²Ñ‚Ñ€Ð° Ð¾Ð½Ð° Ð¿Ð¾ÑÐ²Ð¸Ñ‚ÑÑ!')
  }
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐœÐ¾Ð¸ Ð±Ð¸Ð·Ð½ÐµÑÑ‹"
bot.hears('ÐœÐ¾Ð¸ Ð±Ð¸Ð·Ð½ÐµÑÑ‹', async (ctx) => {
  let business = await db.listBusiness(ctx.from.id)
  ctx.session.businessCount = business.length
  var keys = []
  console.log(business)
  if (business != undefined) {
    for (let bus of business) {
      const bustype = db.BUSINESS_TYPES[bus.type]
      keys.push([{
        text: `${bus.type} Ð£Ñ€.${bus.upgrades} - ${bus.employees}/${bustype.maxEmployeeCount}`,
        callback_data: `${bus.id}`
      }])
    }
  }
  await ctx.reply(`Ð’Ð°ÑˆÐ¸ Ð±Ð¸Ð·Ð½ÐµÑÑ‹: ${business?.length}`, Markup.inlineKeyboard(
    keys
  ))
  ctx.session.state = 'list_business'
});

async function editBusinessDataFromContext(ctx) {
  let business = await db.getBusiness(ctx.session.business_id)
  let vars = db.BUSINESS_TYPES[business.type]
  let text = `Ð‘Ð¸Ð·Ð½ÐµÑ ${vars.friendlyName} ðŸ’¹
Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: ${db.CATEGORIES[vars.category]}
Ð”Ð¾Ñ…Ð¾Ð´Ð½Ð¾ÑÑ‚ÑŒ: ${vars.profitPerEmployee * business.employees * vars.equipmentMultiplier[business.upgrades - 1]}
Ð¡Ð¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð²: ${business.employees}/${vars.maxEmployeeCount}`
  
  let keys = [
    [
      {text: 'Ð£Ð»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ ($123)', callback_data: 'action_upgrade'},
      {text: 'ÐÐ°Ð½ÑÑ‚ÑŒ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ° ($100)', callback_data: 'action_hire'}
    ],
    [
      {text: 'ÐŸÑ€Ð¾Ð´Ð°Ñ‚ÑŒ Ð³Ð¾ÑÑƒÐ´Ð°Ñ€ÑÑ‚Ð²Ñƒ (50%)', callback_data: 'action_sell_to_state'},
      {text: 'ÐŸÑ€Ð¾Ð´Ð°Ñ‚ÑŒ Ð¸Ð³Ñ€Ð¾ÐºÑƒ', callback_data: 'action_sell_to_user'}
    ]
  ]

  await ctx.editMessageText(text, Markup.inlineKeyboard(keys).resize())
}

bot.on('callback_query', async (ctx) => {
  var msg = ctx.message;

  if (ctx.callbackQuery.data == 'Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´') {
    ctx.replyWithHTML(
      'ÐÐ¸Ð¶Ðµ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÐµÐ½ Ð½Ð°Ð±Ð¾Ñ€ ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð´Ð»Ñ Ð¸Ð³Ñ€Ñ‹ â¬‡ï¸\n\n'+
      '/start' + '-Ð´Ð°Ð½Ð½Ð°Ñ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ñ Ð¿Ñ€ÐµÐ´Ð½Ð°Ð·Ð½Ð°Ñ‡ÐµÐ½Ð° Ð´Ð»Ñ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð±Ð¾Ñ‚Ð°, Ð»Ð¸Ð±Ð¾ ÐµÑÐ»Ð¸ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð¸Ð³Ñ€Ñƒ Ð·Ð°Ð½Ð¾Ð²Ð¾.\n' +
      '/toplist' + '-Ð²Ñ‹Ð²Ð¾Ð´ ÑÐ¿Ð¸ÑÐºÐ° ÑÐ°Ð¼Ñ‹Ñ… ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ñ… Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÐµÐ¹.\n' +
      '/bybiz id' + '(Ð·Ð°Ð¼ÐµÐ½Ð¸Ñ‚Ðµ ÑÐ»Ð¾Ð²Ð¾ id Ð½Ð° id Ð±Ð¸Ð·Ð½ÐµÑÐ°)' + '-ÐºÐ¾Ð¼Ð°Ð½Ð´Ð° Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ Ð´Ð»Ñ Ñ€ÐµÐ°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð±Ð¸Ð·Ð½ÐµÑÐ° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ð¾Ð³Ð¾ Ðº Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ðµ.')
    return
  }

  if (ctx.callbackQuery.data == 'ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð¸Ð³Ñ€Ñ‹') {
    ctx.replyWithHTML(
     'Ð¨Ð°Ð³ 1: Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¸Ð¼Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€"!\n' +
     'ÐŸÑ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÐµÐ¼ Ð²Ð°Ñ Ð² Ð·Ð°Ñ…Ð²Ð°Ñ‚Ñ‹Ð²Ð°ÑŽÑ‰ÐµÐ¼ Ð¼Ð¸Ñ€Ðµ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÑÑ‚Ð²Ð° Ð¸ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð¾Ð³Ð¾ ÑƒÑÐ¿ÐµÑ…Ð°. Ð’ ÑÑ‚Ð¾Ð¼ Ñ‚ÑƒÑ‚Ð¾Ñ€Ð¸Ð°Ð»Ðµ Ð¼Ñ‹ Ð¿Ð¾Ð¼Ð¾Ð¶ÐµÐ¼ Ð²Ð°Ð¼ Ð¾Ð²Ð»Ð°Ð´ÐµÑ‚ÑŒ Ð¾ÑÐ½Ð¾Ð²Ð°Ð¼Ð¸ Ð¸Ð³Ñ€Ñ‹ Ð¸ ÑÑ‚Ð°Ñ‚ÑŒ  ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ ÑÐºÑÐ¿ÐµÑ€Ñ‚Ð¾Ð¼.\n\n' +
     'Ð¨Ð°Ð³ 2: ÐžÑÐ½Ð¾Ð²Ñ‹ Ð¸Ð³Ñ€Ð¾Ð²Ð¾Ð³Ð¾ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ°.\n' +
     'ÐÐ° ÑÐºÑ€Ð°Ð½Ðµ Ð²Ñ‹ ÑƒÐ²Ð¸Ð´Ð¸Ñ‚Ðµ ÐºÐ°Ñ€Ñ‚Ñƒ Ð³Ð¾Ñ€Ð¾Ð´Ð°, ÐºÐ¾Ñ‚Ð¾Ñ€Ð°Ñ Ð±ÑƒÐ´ÐµÑ‚ Ð²Ð°ÑˆÐ¸Ð¼ Ð¸Ð³Ñ€Ð¾Ð²Ñ‹Ð¼ Ð¿Ð¾Ð»ÐµÐ¼. Ð¡Ð»ÐµÐ²Ð° Ñ€Ð°ÑÐ¿Ð¾Ð»Ð¾Ð¶ÐµÐ½Ñ‹ ÐºÐ½Ð¾Ð¿ÐºÐ¸ Ð¸ Ð¼ÐµÐ½ÑŽ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¿Ð¾Ð·Ð²Ð¾Ð»ÑÑ‚ Ð²Ð°Ð¼ Ð²Ð·Ð°Ð¸Ð¼Ð¾Ð´ÐµÐ¹ÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ Ñ Ð¸Ð³Ñ€Ð¾Ð¹. ÐžÐ±Ñ€Ð°Ñ‚Ð¸Ñ‚Ðµ Ð²Ð½Ð¸Ð¼Ð°Ð½Ð¸Ðµ Ð½Ð° Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ Ð²Ð°Ð¼ Ñ€ÐµÑÑƒÑ€ÑÑ‹, Ð±Ð°Ð»Ð°Ð½Ñ ÑÑ€ÐµÐ´ÑÑ‚Ð² Ð¸ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸.\n\n' +
     'Ð¨Ð°Ð³ 3: ÐŸÐ¾ÐºÑƒÐ¿ÐºÐ° Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ñ.\n' +
     'Ð§Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ Ð±Ð¸Ð·Ð½ÐµÑ, Ð²Ð°Ð¼ Ð½ÑƒÐ¶Ð½Ð¾ Ð¿Ñ€Ð¸Ð¾Ð±Ñ€ÐµÑÑ‚Ð¸ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚ÑŒ. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐšÑƒÐ¿Ð¸Ñ‚ÑŒ" Ð½Ð° Ð¿Ð°Ð½ÐµÐ»Ð¸ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð² Ð¸ Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ð¹ Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ ÑƒÑ‡Ð°ÑÑ‚Ð¾Ðº Ð·ÐµÐ¼Ð»Ð¸ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ðµ Ð³Ð¾Ñ€Ð¾Ð´Ð°. Ð—Ð°Ñ‚ÐµÐ¼ Ð¿Ð¾Ð´Ñ‚Ð²ÐµÑ€Ð´Ð¸Ñ‚Ðµ Ð¿Ð¾ÐºÑƒÐ¿ÐºÑƒ Ð¸ Ð²Ñ‹ ÑÑ‚Ð°Ð½ÐµÑ‚Ðµ Ð²Ð»Ð°Ð´ÐµÐ»ÑŒÑ†ÐµÐ¼ ÑÑ‚Ð¾Ð³Ð¾ ÑƒÑ‡Ð°ÑÑ‚ÐºÐ°.\n\n' +
     'Ð¨Ð°Ð³ 4: Ð Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð¸ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ñ.\n' +
     'Ð¢ÐµÐ¿ÐµÑ€ÑŒ, ÐºÐ¾Ð³Ð´Ð° Ñƒ Ð²Ð°Ñ ÐµÑÑ‚ÑŒ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚ÑŒ, Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ñ€Ð°Ð·Ð²Ð¸Ð²Ð°Ñ‚ÑŒ ÐµÐµ. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "Ð£Ð»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ" Ñ€ÑÐ´Ð¾Ð¼ Ñ Ð²Ð°ÑˆÐ¸Ð¼ Ð¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð¼ Ð¸ Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ñ, ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ñ…Ð¾Ñ‚Ð¸Ñ‚Ðµ ÑÐ´ÐµÐ»Ð°Ñ‚ÑŒ. Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¿Ð¾Ð²Ñ‹ÑˆÐ°ÐµÑ‚ ÐµÐµ ÑÑ‚Ð¾Ð¸Ð¼Ð¾ÑÑ‚ÑŒ Ð¸ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ.\n\n' +
     'Ð¨Ð°Ð³ 7: Ð Ñ‹Ð½Ð¾Ðº Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¸ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð»Ñ.\n' +
     'ÐÐµ Ð·Ð°Ð±Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ ÑÐ»ÐµÐ´Ð¸Ñ‚ÑŒ Ð·Ð° Ñ€Ñ‹Ð½Ð¾Ñ‡Ð½Ð¾Ð¹ ÑÐ¸Ñ‚ÑƒÐ°Ñ†Ð¸ÐµÐ¹ Ð¸ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð¾ Ñ‚Ð¾Ñ€Ð³Ð¾Ð²Ð°Ñ‚ÑŒ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚ÑŒÑŽ. Ð˜Ð½Ð¾Ð³Ð´Ð° Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð½Ð°Ð¹Ñ‚Ð¸ Ð²Ñ‹Ð³Ð¾Ð´Ð½Ñ‹Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð´Ð»Ñ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð¸Ð»Ð¸ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸ Ð¸Ð¼ÑƒÑ‰ÐµÑÑ‚Ð²Ð°. ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ð½Ð° ÐºÐ½Ð¾Ð¿ÐºÑƒ "ÐšÐ°Ñ€Ñ‚Ð° Ð±Ð¸Ð·Ð½ÐµÑÐ¾Ð²" Ð¸ Ð¸Ð·ÑƒÑ‡Ð¸Ñ‚Ðµ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð½Ñ‹Ðµ ÑÐ´ÐµÐ»ÐºÐ¸. Ð’Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ñ€ÐµÐ´Ð»Ð°Ð³Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¸ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ñ Ð½Ð° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ñƒ Ð¸Ð»Ð¸ Ð¿Ð¾ÐºÑƒÐ¿Ð°Ñ‚ÑŒ Ð¿Ñ€ÐµÐ´Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ Ð´Ñ€ÑƒÐ³Ð¸Ñ… Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð².\n\n' +
     'Ð¨Ð°Ð³ 8: Ð¡Ñ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ñ€Ð¾ÑÑ‚ Ð¸ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ðµ Ð±Ð¸Ð·Ð½ÐµÑÐ°.\n' +
     'Ð§Ñ‚Ð¾Ð±Ñ‹ ÑÑ‚Ð°Ñ‚ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ð¼ ÑÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ Ð¸Ð¼Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð¾Ð¼, Ð²Ð°Ð¼ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ‡ÐµÑÐºÐ¸ Ð¿Ð»Ð°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸ Ñ€Ð°Ð·Ð²Ð¸Ð²Ð°Ñ‚ÑŒ ÑÐ²Ð¾Ð¹ Ð±Ð¸Ð·Ð½ÐµÑ. Ð Ð°ÑÑÐ¼Ð¾Ñ‚Ñ€Ð¸Ñ‚Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ñ€Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð¸Ñ ÑˆÑ‚Ð°Ñ‚Ð° ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð², Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð´Ð¾Ð¿Ð¾Ð»Ð½Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð½ÐµÐ´Ð²Ð¸Ð¶Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¸Ð»Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐ° Ð½Ð¾Ð²Ñ‹Ñ… Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ð¹. Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ð¾Ð¸ Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ñ‹Ðµ Ñ€ÐµÑÑƒÑ€ÑÑ‹ Ñ ÑƒÐ¼Ð¾Ð¼ Ð¸ Ð´Ð¾Ð±Ð¸Ð²Ð°Ð¹Ñ‚ÐµÑÑŒ Ð¿Ð¾ÑÑ‚Ð¾ÑÐ½Ð½Ð¾Ð³Ð¾ Ñ€Ð¾ÑÑ‚Ð° Ð¸ Ð¿Ñ€Ð¾Ñ†Ð²ÐµÑ‚Ð°Ð½Ð¸Ñ.\n\n' +
     'Ð¨Ð°Ð³ 9: ÐšÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ†Ð¸Ñ Ð¸ Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð².\n' +
     'ÐÐµ Ð·Ð°Ð±Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ, Ñ‡Ñ‚Ð¾ Ð²Ñ‹ Ð½Ðµ ÐµÐ´Ð¸Ð½ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ð¹ Ð¸Ð³Ñ€Ð¾Ðº Ð² Ð¸Ð³Ñ€Ðµ. Ð’Ð°Ñ Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ Ð¾Ð¶ÐµÑÑ‚Ð¾Ñ‡ÐµÐ½Ð½Ð°Ñ ÐºÐ¾Ð½ÐºÑƒÑ€ÐµÐ½Ñ†Ð¸Ñ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑÐ¼Ð¸. Ð¡Ð¾Ñ€ÐµÐ²Ð½ÑƒÐ¹Ñ‚ÐµÑÑŒ Ð·Ð° Ð»Ð¸Ð´ÐµÑ€ÑÑ‚Ð²Ð¾ Ð² Ñ€ÐµÐ¹Ñ‚Ð¸Ð½Ð³Ðµ Ð¸Ð³Ñ€Ð¾ÐºÐ¾Ð², Ð´Ð¾ÑÑ‚Ð¸Ð³Ð°Ð¹Ñ‚Ðµ Ð²Ñ‹ÑÐ¾ÐºÐ¸Ñ… Ð¿Ð¾Ð·Ð¸Ñ†Ð¸Ð¹ Ð¸ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐ²Ð¾Ð¸ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ð½Ð°Ð²Ñ‹ÐºÐ¸. Ð¢Ð¾Ð¿Ð¾Ð² Ð¼Ð¾Ð¶Ð½Ð¾ Ð½Ð°Ð¹Ñ‚Ð¸ Ð² ÑÐ¿Ð¸ÑÐºÐµ Ð¿Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ /toplist\n\n' +
     'Ð¨Ð°Ð³ 10: ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ.\n' +
     'Ð˜Ð³Ñ€Ð° Ð±ÑƒÐ´ÐµÑ‚ Ñ€ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ð¾ Ð¾Ð±Ð½Ð¾Ð²Ð»ÑÑ‚ÑŒÑÑ Ñ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸ÐµÐ¼ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÐºÐ¾Ð½Ñ‚ÐµÐ½Ñ‚Ð°, Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹. Ð‘ÑƒÐ´ÑŒÑ‚Ðµ Ð² ÐºÑƒÑ€ÑÐµ Ð²ÑÐµÑ… Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ð¹, ÑƒÑ‡Ð°ÑÑ‚Ð²ÑƒÐ¹Ñ‚Ðµ Ð² ÑÐ¾Ð±Ñ‹Ñ‚Ð¸ÑÑ… Ð¸ Ð¿Ð¾Ð»ÑƒÑ‡Ð°Ð¹Ñ‚Ðµ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ Ð´Ð»Ñ Ñ€Ð°Ð·Ð²Ð¸Ñ‚Ð¸Ñ ÑÐ²Ð¾ÐµÐ³Ð¾ Ð±Ð¸Ð·Ð½ÐµÑÐ°.\n\n' +
     'Ð¨Ð°Ð³ 11: ÐŸÐ¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ Ð¸ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°.\n' +
     'Ð•ÑÐ»Ð¸ Ñƒ Ð²Ð°Ñ Ð²Ð¾Ð·Ð½Ð¸ÐºÐ½ÑƒÑ‚ Ð²Ð¾Ð¿Ñ€Ð¾ÑÑ‹ Ð¸Ð»Ð¸ Ð¿Ð¾Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¿Ð¾Ð¼Ð¾Ñ‰ÑŒ, Ð¾Ð±Ñ€Ð°Ñ‚Ð¸Ñ‚ÐµÑÑŒ Ðº Ð½Ð°ÑˆÐµÐ¹ ÐºÐ¾Ð¼Ð°Ð½Ð´Ðµ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¸. ÐœÑ‹ Ð²ÑÐµÐ³Ð´Ð° Ð³Ð¾Ñ‚Ð¾Ð²Ñ‹ Ð¿Ð¾Ð¼Ð¾Ñ‡ÑŒ Ð²Ð°Ð¼ Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð»ÑŽÐ±Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð¸ Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸ Ð¿Ð¾ Ð¸Ð³Ñ€Ðµ.\n\n' +
     'Ð¨Ð°Ð³ 12: Ð—Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ðµ Ñ‚ÑƒÑ‚Ð¾Ñ€Ð¸Ð°Ð»Ð° Ð¸ Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð²Ð°ÑˆÐµÐ³Ð¾ Ð¿ÑƒÑ‚Ð¸ Ðº ÑƒÑÐ¿ÐµÑ…Ñƒ!\n' +
     'ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÑÐµÐ¼! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð²Ñ‹ Ð¾Ð²Ð»Ð°Ð´ÐµÐ»Ð¸ Ð¾ÑÐ½Ð¾Ð²Ð°Ð¼Ð¸ Ð¸Ð³Ñ€Ñ‹ "Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¸Ð¼Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€". Ð’Ð°ÑˆÐµ Ð¿ÑƒÑ‚ÐµÑˆÐµÑÑ‚Ð²Ð¸Ðµ Ðº Ñ„Ð¸Ð½Ð°Ð½ÑÐ¾Ð²Ð¾Ð¼Ñƒ Ð¿Ñ€Ð¾Ñ†Ð²ÐµÑ‚Ð°Ð½Ð¸ÑŽ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð½Ð°Ñ‡Ð¸Ð½Ð°ÐµÑ‚ÑÑ. ÐŸÑ€Ð¾ÑÐ²Ð¸Ñ‚Ðµ ÑÐ²Ð¾Ð¸ Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ñ‚ÐµÐ»ÑŒÑÐºÐ¸Ðµ Ð½Ð°Ð²Ñ‹ÐºÐ¸, Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ñ€Ð°Ñ‚ÐµÐ³Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð¸ Ð´Ð¾ÑÑ‚Ð¸Ð³Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ñ… Ð²Ñ‹ÑÐ¾Ñ‚ Ð² Ð±Ð¸Ð·Ð½ÐµÑÐµ.\n'
    );
    return
  };
  
  if (ctx.session.state == 'list_business') {
    let business_id = ctx.callbackQuery.data
    ctx.session.state = 'business_detail'
    ctx.session.business_id = business_id
    
    await editBusinessDataFromContext(ctx)
  }
  
  if (ctx.session.state == 'business_detail') {
    let user = await db.getUser(ctx.from.id)
    let business = await db.getBusiness(ctx.session.business_id)
    let vars = db.BUSINESS_TYPES[business.type]
    if (ctx.callbackQuery.data == 'action_upgrade') {
      if (business.upgrades >= 3) {
        ctx.reply('Ð£ Ð²Ð°Ñ Ð¸ Ñ‚Ð°Ðº Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½Ð¸Ðµ')
      } else {
        if (db.removeMoney(ctx.from.id, 123)) {
          business.upgrades += 1
          await db.updateBusiness(business)
          ctx.reply(`Ð‘Ð¸Ð·Ð½ÐµÑ Ñ‚ÐµÐ¿ÐµÑ€ÑŒ ÑƒÐ»ÑƒÑ‡ÑˆÐµÐ½ Ð½Ð° ${business.upgrades}/3!`)
        } else {
          ctx.reply('Ð’Ð°Ð¼ Ð½Ðµ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ Ð´ÐµÐ½ÐµÐ³, Ñ‡Ñ‚Ð¾Ð±Ñ‹ ÑƒÐ»ÑƒÑ‡ÑˆÐ¸Ñ‚ÑŒ Ð±Ð¸Ð·Ð½ÐµÑ.')
        }
      }
    } else if (ctx.callbackQuery.data == 'action_hire') {
      if (business.employees >= vars.maxEmployeeCount) {
        ctx.reply('Ð’ Ð²Ð°ÑˆÐµÐ¼ Ð±Ð¸Ð·Ð½ÐµÑÐµ Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ¾Ð².')
      } else {
        if (await db.removeMoney(ctx.from.id, 100)) {
          business.employees += 1
          await db.updateBusiness(business)
          await editBusinessDataFromContext(ctx)
          ctx.reply(`Ð’Ñ‹ Ð½Ð°Ð½ÑÐ»Ð¸ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°! Ð¢ÐµÐ¿ÐµÑ€ÑŒ Ð¸Ñ… ${business.employees}/${vars.maxEmployeeCount}.`)
        } else {
          ctx.reply('Ð’Ð°Ð¼ Ð½Ðµ Ñ…Ð²Ð°Ñ‚Ð°ÐµÑ‚ Ð´ÐµÐ½ÐµÐ³, Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð½Ð°Ð½ÑÑ‚ÑŒ Ð½Ð¾Ð²Ð¾Ð³Ð¾ ÑÐ¾Ñ‚Ñ€ÑƒÐ´Ð½Ð¸ÐºÐ°.')
        }
      }
    } else if (ctx.callbackQuery.data == 'action_sell_to_state') {
      user.balance += (vars.price * 0.5) % 1
      await db.updateUser(user)
      business.owner = null
      await db.updateBusiness(business)
      ctx.deleteMessage(ctx.callbackQuery.message.id)
      ctx.reply('Ð’Ñ‹ Ð¿Ñ€Ð¾Ð´Ð°Ð»Ð¸ Ð±Ð¸Ð·Ð½ÐµÑ Ð³Ð¾ÑÑƒÐ´Ð°Ñ€ÑÑ‚Ð²Ñƒ, Ð±Ð¾Ð»ÑŒÑˆÐµ Ð¾Ð½ Ð²Ð°Ð¼ Ð½Ðµ Ð¿Ñ€Ð¸Ð½Ð°Ð´Ð»ÐµÐ¶Ð¸Ñ‚')
      ctx.session.state = ''
    }
  }

  await ctx.answerCbQuery()
})

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸ "Ð§Ð°Ñ‚ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²"
bot.hears('Ð§Ð°Ñ‚ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²', (ctx) => {
  ctx.reply('Ð—Ð°Ð»ÐµÑ‚Ð°Ð¹Ñ‚Ðµ Ð² Ð½Ð°Ñˆ Ñ‡Ð°Ñ‚ Ð¸ Ð¾Ð±Ð¼ÐµÐ½Ð¸Ð²Ð°Ð¹Ñ‚ÐµÑÑŒ Ð±Ð¸Ð·Ð½ÐµÑÐ°Ð¼Ð¸ Ñ Ð´Ñ€ÑƒÐ³Ð¸Ð¼Ð¸ Ð»ÑŽÐ´ÑŒÐ¼Ð¸! ðŸ¤‘', Markup.inlineKeyboard([
    Markup.button.url('ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð² Ñ‡Ð°Ñ‚', 'https://t.me/+tcgVdSKiygY0Njky')
  ]));
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸"
bot.hears('ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸', (ctx) => {
  ctx.reply('Ð’Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÐµÑÑŒ Ð² Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ñ…. Ð—Ð´ÐµÑÑŒ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð¸ Ð¿Ñ€ÐµÐ´Ð¿Ð¾Ñ‡Ñ‚ÐµÐ½Ð¸Ñ.');
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐŸÐ»Ð¾Ñ‰Ð°Ð´ÐºÐ° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸"
bot.hears('ÐŸÐ»Ð¾Ñ‰Ð°Ð´ÐºÐ° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸', (ctx) => {
  ctx.reply('Ð’Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÐµÑÑŒ Ð½Ð° Ð¿Ð»Ð¾Ñ‰Ð°Ð´ÐºÐµ Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸/Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð²Ð°Ð»ÑŽÑ‚Ñ‹. Ð—Ð´ÐµÑÑŒ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¾ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð»ÑÑ‚ÑŒ Ð¾Ð¿ÐµÑ€Ð°Ñ†Ð¸Ð¸ Ñ Ð²Ð°Ð»ÑŽÑ‚Ð¾Ð¹.');
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐšÐ°Ñ€Ñ‚Ð° Ð±Ð¸Ð·Ð½ÐµÑÐ¾Ð²"
bot.hears('ÐšÐ°Ñ€Ñ‚Ð° Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ð¹', (ctx) => {
  ctx.reply('ÐšÐ°Ñ€Ñ‚Ð° Ð¾Ñ‚ÐºÑ€Ð¾ÐµÑ‚ÑÑ Ð² Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾Ð¼ Ð¾ÐºÐ½Ðµ Ð±Ñ€Ð°ÑƒÐ·ÐµÑ€Ð°, Ð³Ð´Ðµ Ð²Ñ‹ Ð¼Ð¾Ð¶ÐµÑ‚Ðµ Ð¿Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ÐµÑ‚ÑŒ Ð²Ð°Ñ€Ð¸Ð°Ð½Ñ‚Ñ‹ Ð¿Ð¾ÐºÑƒÐ¿ÐºÐ¸ Ð±Ð¸Ð·Ð½ÐµÑÑÐ°! ðŸ’¸', Markup.inlineKeyboard([
    Markup.button.url('ÐŸÐµÑ€ÐµÐ¹Ñ‚Ð¸ Ð½Ð° ÐºÐ°Ñ€Ñ‚Ñƒ Ð±Ð¸Ð·Ð½ÐµÑÐ¾Ð²', 'https://samp-maps-burrubin.vercel.app/')]));
});

// ÐžÐ±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº ÐºÐ½Ð¾Ð¿ÐºÐ¸ "ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð¿Ð¾ Ð¸Ð³Ñ€Ðµ"
bot.hears('ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð¿Ð¾ Ð¸Ð³Ñ€Ðµ', (ctx) => {
  ctx.reply('Ð’Ñ‹ Ð½Ð°Ñ…Ð¾Ð´Ð¸Ñ‚ÐµÑÑŒ Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸. Ð—Ð´ÐµÑÑŒ Ð²Ñ‹ ÑÐ¼Ð¾Ð¶ÐµÑ‚Ðµ ÑƒÐ·Ð½Ð°Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð¸Ð³Ñ€Ñ‹, ÑƒÐ·Ð½Ð°Ñ‚ÑŒ ÑÐ¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´, Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÑƒ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ñ‹ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¾Ð² Ð¸Ð³Ñ€Ñ‹! ðŸ§žâ€â™‚ï¸', Markup.inlineKeyboard([
    Markup.button.callback('Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´', "Ð¡Ð¿Ð¸ÑÐ¾Ðº ÐºÐ¾Ð¼Ð°Ð½Ð´"), Markup.button.callback('ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð¸Ð³Ñ€Ñ‹', "ÐŸÑ€Ð°Ð²Ð¸Ð»Ð° Ð¸Ð³Ñ€Ñ‹"), Markup.button.url('ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°', 'https://t.me/+tcgVdSKiygY0Njky')
]));
});
 
bot.on('message', async (ctx) => {
  if (ctx.session.state == 'wait_for_name') {
    ctx.session.state = ''
    const name = ctx.message.text
    await db.register(ctx.from.id, name, 500000)

    await ctx.reply('Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ! Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ðµ:', Markup
      .keyboard([
        ['ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð±Ñ‹Ð»ÑŒ', 'ÐœÐ¾Ð¸ Ð±Ð¸Ð·Ð½ÐµÑÑ‹'],
        ['Ð§Ð°Ñ‚ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²', 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸'],
        ['ÐŸÐ»Ð¾Ñ‰Ð°Ð´ÐºÐ° Ð¿Ñ€Ð¾Ð´Ð°Ð¶Ð¸', 'ÐšÐ°Ñ€Ñ‚Ð° Ð¿Ñ€ÐµÐ´Ð¿Ñ€Ð¸ÑÑ‚Ð¸Ð¹'],
        ['ÐŸÐ¾Ð¼Ð¾Ñ‰ÑŒ Ð¿Ð¾ Ð¸Ð³Ñ€Ðµ']
      ])
      .resize()
    );
  }
})

bot.launch();

// Enable graceful stop
process.once('SIGINT', () => bot.stop('SIGINT'));
process.once('SIGTERM', () => bot.stop('SIGTERM'));
